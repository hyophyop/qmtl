
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="QMTL Team">
      
      
      
        <link rel="prev" href="../controlbus/">
      
      
        <link rel="next" href="../../reference/api/brokerage/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Lean Brokerage Model - QMTL Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="QMTL Documentation" class="md-header__button md-logo" aria-label="QMTL Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QMTL Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lean Brokerage Model
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="QMTL Documentation" class="md-nav__button md-logo" aria-label="QMTL Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    QMTL Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MAINTENANCE_SCHEDULE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maintenance Schedule
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture & Ownership
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dag-manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DAG Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gateway
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../worldservice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    World Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../controlbus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ControlBus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Lean Brokerage Model
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lean Brokerage Model
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      관련 문서
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-lean" class="md-nav__link">
    <span class="md-ellipsis">
      1) Lean의 브로커리지 모델이 하는 일(한눈 요약)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2) 구성 요소별로 필요한 기술
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2) 구성 요소별로 필요한 기술">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-validation" class="md-nav__link">
    <span class="md-ellipsis">
      A. 주문 전 검증(Validation) &amp; 기본 속성
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b" class="md-nav__link">
    <span class="md-ellipsis">
      B. 시장 시간·캘린더
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      C. 매수력/레버리지(마진)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d" class="md-nav__link">
    <span class="md-ellipsis">
      D. 체결 가격·수량
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e" class="md-nav__link">
    <span class="md-ellipsis">
      E. 비용·현금흐름
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#f-short-availability" class="md-nav__link">
    <span class="md-ellipsis">
      F. 공매도 가능수량(Short Availability)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#g" class="md-nav__link">
    <span class="md-ellipsis">
      G. 실거래/데이터 통합(브로커 연결 시)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3) 어떻게 조합해서 쓸 것인가: “브로커리지 프로파일” 파이프라인
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3) 어떻게 조합해서 쓸 것인가: “브로커리지 프로파일” 파이프라인">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0" class="md-nav__link">
    <span class="md-ellipsis">
      (0) 보안종목 초기화 시
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-pre-trade" class="md-nav__link">
    <span class="md-ellipsis">
      (1) Pre-Trade 검증
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-execution" class="md-nav__link">
    <span class="md-ellipsis">
      (2) Execution(체결 산출)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-post-trade" class="md-nav__link">
    <span class="md-ellipsis">
      (3) Post-Trade 회계 처리
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4) 브로커리지 프로파일 설계 체크리스트(기술 포인트)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-qmtl" class="md-nav__link">
    <span class="md-ellipsis">
      5) QMTL에 이식할 때의 모듈 배치(권장 아키텍처)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-ibkr" class="md-nav__link">
    <span class="md-ellipsis">
      6) 예시: IBKR 프로파일 구성 레시피
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-poc" class="md-nav__link">
    <span class="md-ellipsis">
      7) 구현 순서(POC 체크리스트)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7) 구현 순서(POC 체크리스트)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      마무리
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-note-worlds-and-brokerage" class="md-nav__link">
    <span class="md-ellipsis">
      Integration Note: Worlds and Brokerage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration Note: Worlds and Brokerage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qmtl-module-mapping-implementation-pointers" class="md-nav__link">
    <span class="md-ellipsis">
      QMTL Module Mapping (Implementation Pointers)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/brokerage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Brokerage API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../implementation_todos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementation TODOs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/sdk_tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SDK Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/strategy_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Strategy Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/backfill/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backfill
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/canary_rollout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Canary Rollout
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/e2e_testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    E2E Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/activation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    World Activation Runbook
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/risk_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Risk Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/timing_controls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timing Controls
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/schemas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Schemas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api_world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    World API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/enhanced_validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enhanced Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/backtest_validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backtest Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/lean_like_features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lean-like Features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/brokerage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Brokerage API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/_inventory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inventory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    World
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            World
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../world/world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../world/realm_rename_eval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Realm Terminology Evaluation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../templates/template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Template
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      관련 문서
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-lean" class="md-nav__link">
    <span class="md-ellipsis">
      1) Lean의 브로커리지 모델이 하는 일(한눈 요약)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2) 구성 요소별로 필요한 기술
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2) 구성 요소별로 필요한 기술">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-validation" class="md-nav__link">
    <span class="md-ellipsis">
      A. 주문 전 검증(Validation) &amp; 기본 속성
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b" class="md-nav__link">
    <span class="md-ellipsis">
      B. 시장 시간·캘린더
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      C. 매수력/레버리지(마진)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d" class="md-nav__link">
    <span class="md-ellipsis">
      D. 체결 가격·수량
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e" class="md-nav__link">
    <span class="md-ellipsis">
      E. 비용·현금흐름
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#f-short-availability" class="md-nav__link">
    <span class="md-ellipsis">
      F. 공매도 가능수량(Short Availability)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#g" class="md-nav__link">
    <span class="md-ellipsis">
      G. 실거래/데이터 통합(브로커 연결 시)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3) 어떻게 조합해서 쓸 것인가: “브로커리지 프로파일” 파이프라인
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3) 어떻게 조합해서 쓸 것인가: “브로커리지 프로파일” 파이프라인">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0" class="md-nav__link">
    <span class="md-ellipsis">
      (0) 보안종목 초기화 시
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-pre-trade" class="md-nav__link">
    <span class="md-ellipsis">
      (1) Pre-Trade 검증
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-execution" class="md-nav__link">
    <span class="md-ellipsis">
      (2) Execution(체결 산출)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-post-trade" class="md-nav__link">
    <span class="md-ellipsis">
      (3) Post-Trade 회계 처리
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4) 브로커리지 프로파일 설계 체크리스트(기술 포인트)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-qmtl" class="md-nav__link">
    <span class="md-ellipsis">
      5) QMTL에 이식할 때의 모듈 배치(권장 아키텍처)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-ibkr" class="md-nav__link">
    <span class="md-ellipsis">
      6) 예시: IBKR 프로파일 구성 레시피
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-poc" class="md-nav__link">
    <span class="md-ellipsis">
      7) 구현 순서(POC 체크리스트)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7) 구현 순서(POC 체크리스트)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      마무리
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-note-worlds-and-brokerage" class="md-nav__link">
    <span class="md-ellipsis">
      Integration Note: Worlds and Brokerage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration Note: Worlds and Brokerage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qmtl-module-mapping-implementation-pointers" class="md-nav__link">
    <span class="md-ellipsis">
      QMTL Module Mapping (Implementation Pointers)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Lean Brokerage Model</h1>

<p><a href="/">Home</a> / <a href="/architecture">architecture</a> / <a href="/architecture/lean_brokerage_model">lean_brokerage_model</a>
<strong>Related:</strong> <a href="../">Overview</a>, <a href="../architecture/">Architecture &amp; Ownership</a>, <a href="../glossary/">Glossary</a>, <a href="../dag-manager/">DAG Manager</a>, <a href="../gateway/">Gateway</a>, <a href="../worldservice/">World Service</a>, <a href="../controlbus/">ControlBus</a>, <a href="./">Lean Brokerage Model</a>, <a href="../../reference/api/brokerage/">Brokerage API</a>, <a href="../implementation_todos/">Implementation TODOs</a></p>
<h2 id="_1">관련 문서</h2>
<ul>
<li><a href="../">Architecture Overview</a></li>
<li><a href="../architecture/">QMTL Architecture</a></li>
<li><a href="../gateway/">Gateway</a></li>
<li><a href="../dag-manager/">DAG Manager</a></li>
<li><a href="../worldservice/">WorldService</a></li>
</ul>
<p>아래는 **Lean의 ‘브로커리지 모델(Brokerage Model)’**을 구현할 때 필요한 핵심 기술과, 이를 <strong>조합</strong>해 “현실적인 체결·거래 제약”을 한 번에 모델링하는 설계 가이드입니다. 마지막에 <strong>QMTL</strong>로 옮겨 담는 방법(모듈 배치/파이프라인)도 제안합니다.</p>
<hr />
<h2 id="1-lean">1) Lean의 브로커리지 모델이 하는 일(한눈 요약)</h2>
<p>Lean에서 브로커리지 모델은 <strong>브로커별 기본 규칙과 보조 모델들을 한 세트로 묶어</strong> 보안종목(Security)에 적용합니다. 기본 초기화기는 이 세트를 각 종목에 내려서 <strong>Fill / Slippage / Fee / BuyingPower / Settlement / Short Availability / Margin Interest</strong> 등의 “현실 모델”을 자동 설정합니다. 또한 주문 제출 가능 여부(자금·규격·시장 시간·브로커 제한)를 사전에 검증하고, 계좌 유형(현금/마진), 유휴증거금 비율까지 함께 정의합니다. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/universes/settings?utm_source=chatgpt.com" title="Settings"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/universes/settings?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.lean.io/docs/v2/lean-engine/class-reference/IBrokerageModel_8cs_source.html?utm_source=chatgpt.com" title="Common/Brokerages/IBrokerageModel.cs Source File"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/IBrokerageModel_8cs_source.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
<blockquote>
<p>예) <code>InteractiveBrokersBrokerageModel</code>을 설정하면 IB 기본 수수료·레버리지·시장지원 범위·거래 시간 규칙 등과 함께, 해당 브로커 표준의 각종 하위 모델이 종목에 바인딩됩니다. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/brokerages/supported-models/interactive-brokers?utm_source=chatgpt.com" title="Interactive Brokers"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/brokerages/supported-models/interactive-brokers?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</blockquote>
<hr />
<h2 id="2">2) 구성 요소별로 필요한 기술</h2>
<p>아래 기술 블록을 합치면 Lean이 하는 “브로커리지 현실화”를 구현할 수 있습니다.</p>
<h3 id="a-validation">A. 주문 전 검증(Validation) &amp; 기본 속성</h3>
<ul>
<li>
<p><strong>IBrokerageModel 인터페이스</strong>:</p>
</li>
<li>
<p>계좌 유형, <strong>RequiredFreeBuyingPowerPercent</strong>(유휴 매수력 비율), 브로커별 <strong>CanSubmit/CanExecuteOrder</strong> 등 주문 가능 판정 API. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/IBrokerageModel_8cs_source.html?utm_source=chatgpt.com" title="Common/Brokerages/IBrokerageModel.cs Source File"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/IBrokerageModel_8cs_source.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>Order Properties / Time-in-Force</strong>:</p>
</li>
<li>
<p>GTC/GTD/IOC/FOK 등의 만기 규칙, 브로커 기본 값 설정. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/trading-and-orders/order-properties?utm_source=chatgpt.com" title="Order Properties - QuantConnect.com"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/trading-and-orders/order-properties?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Orders_1_1TimeInForce.html?utm_source=chatgpt.com" title="QuantConnect.Orders.TimeInForce Class Reference - LEAN"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Orders_1_1TimeInForce.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>심볼 속성(SymbolProperties / DB)</strong>:</p>
</li>
<li>
<p><strong>최소 호가단위(tick size)</strong>, <strong>로트/최소 주문수량</strong>, <strong>계약승수</strong>, 종목 통화 등. 주문 호가/수량 검증·라운딩에 사용. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SymbolProperties.html?utm_source=chatgpt.com" title="QuantConnect.Securities.SymbolProperties Class Reference"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SymbolProperties.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
</ul>
<h3 id="b">B. 시장 시간·캘린더</h3>
<ul>
<li>
<p><strong>SecurityExchangeHours / MarketHoursDatabase</strong>:</p>
</li>
<li>
<p>정규·프리·애프터 마켓 시간, 조기폐장/휴장 포함. 오더 실행 가능 시간 판정에 사용. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html?utm_source=chatgpt.com" title="QuantConnect.Securities.SecurityExchangeHours Class ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
</ul>
<h3 id="c">C. 매수력/레버리지(마진)</h3>
<ul>
<li>
<p><strong>Buying Power Model (IBuyingPowerModel)</strong>:</p>
</li>
<li>
<p>주문 접수 전 <strong>증거금/레버리지 가능 여부</strong>와 최대 수량 판정. 브로커/시간대/상품에 따라 복잡한 규칙을 캡슐화. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/buying-power?utm_source=chatgpt.com" title="Buying Power"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/buying-power?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Securities_1_1IBuyingPowerModel.html?utm_source=chatgpt.com" title="QuantConnect.Securities.IBuyingPowerModel Interface ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Securities_1_1IBuyingPowerModel.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
</ul>
<h3 id="d">D. 체결 가격·수량</h3>
<ul>
<li>
<p><strong>Fill Model</strong>:</p>
</li>
<li>
<p>주문타입별(시장가/지정가/스탑/개장·폐장가 등) <strong>체결가·체결수량</strong> 결정. <strong>개장/폐장 옥션가격</strong> 사용 가능. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/trade-fills/key-concepts?utm_source=chatgpt.com" title="Trade Fills"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/trade-fills/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>Slippage Model</strong>:</p>
</li>
<li>
<p>스프레드·거래량 비중·시장충격 기반 슬리피지. 기본/사전구현 모델을 제공하고 커스터마이즈 가능. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/slippage/key-concepts?utm_source=chatgpt.com" title="Slippage"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/slippage/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
</ul>
<h3 id="e">E. 비용·현금흐름</h3>
<ul>
<li>
<p><strong>Fee Model (IFeeModel)</strong>:</p>
</li>
<li>
<p>브로커·시장별 <strong>거래 수수료</strong> 구조(고정·퍼센트·브로커 특화). 체결 이벤트에 비용 반영. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/transaction-fees/key-concepts?utm_source=chatgpt.com" title="Transaction Fees"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/transaction-fees/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>Settlement Model (ISettlementModel)</strong>:</p>
</li>
<li>
<p>현금 결제 주기/규칙, 시간 경과에 따른 자금 적용(Scan/ApplyFunds 호출). (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/settlement/key-concepts?utm_source=chatgpt.com" title="Settlement"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/settlement/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>Margin Interest Model</strong>:</p>
</li>
<li>
<p>차입금에 대한 일할 이자/월말 정산 등 마진 이자 모델. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/margin-interest-rate/key-concepts?utm_source=chatgpt.com" title="Margin Interest Rate"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/margin-interest-rate/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Securities_1_1IMarginInterestRateModel.html?utm_source=chatgpt.com" title="Lean: QuantConnect.Securities.IMarginInterestRateModel ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Securities_1_1IMarginInterestRateModel.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>CashBook/환전</strong>:</p>
</li>
<li>
<p>다통화 포트폴리오 현금 장부·환율변환·총자산 반영. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/portfolio/cashbook?utm_source=chatgpt.com" title="Cashbook"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/portfolio/cashbook?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1Cash.html?utm_source=chatgpt.com" title="QuantConnect.Securities.Cash Class Reference"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1Cash.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
</ul>
<h3 id="f-short-availability">F. 공매도 가능수량(Short Availability)</h3>
<ul>
<li>
<p><strong>IShortableProvider &amp; 데이터셋</strong>:</p>
</li>
<li>
<p>대차 가능한 주식 수량·대차비용 모델링 → 없으면 공매도 주문 거부. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IShortableProvider.html?utm_source=chatgpt.com" title="QuantConnect.Interfaces. IShortableProvider ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IShortableProvider.html?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/short-availability/key-concepts?utm_source=chatgpt.com" title="Short Availability"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/short-availability/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
</ul>
<h3 id="g">G. 실거래/데이터 통합(브로커 연결 시)</h3>
<ul>
<li>
<p><strong>IBrokerage / Factory / Data 핸들러</strong>:</p>
</li>
<li>
<p>실거래 연결은 <code>IBrokerage</code>(주문·계좌 API) + <code>IBrokerageFactory</code>로 구성, 실시간 데이터는 <code>IDataQueueHandler</code>, 실거래 중 히스토리는 <code>IHistoryProvider</code>, 데이터 다운로드는 <code>IDataDownloader</code>로 표준화. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IBrokerage.html?utm_source=chatgpt.com" title="QuantConnect.Interfaces.IBrokerage Interface Reference"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IBrokerage.html?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.quantconnect.com/docs/v2/lean-engine/contributions/brokerages/laying-the-foundation?utm_source=chatgpt.com" title="Laying the Foundation"><a href="https://www.quantconnect.com/docs/v2/lean-engine/contributions/brokerages/laying-the-foundation?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
</ul>
<hr />
<h2 id="3">3) 어떻게 <strong>조합</strong>해서 쓸 것인가: “브로커리지 프로파일” 파이프라인</h2>
<p>아래는 브로커리지를 하나의 <strong>Profile</strong>로 캡슐화해, 주문이 들어올 때 거치는 <strong>전-중-후 파이프라인</strong>입니다. (Lean의 기본 초기화기 방식과 동일한 철학)</p>
<h3 id="0">(0) 보안종목 초기화 시</h3>
<ul>
<li>
<p><strong>SecurityInitializer ← BrokerageModel</strong></p>
</li>
<li>
<p>해당 프로파일의 <strong>Fill/Slippage/Fee/BuyingPower/Settlement/ShortAvailability/MarginInterest</strong>를 종목에 세팅. 레버리지/시드/시드환전도 설정. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/universes/settings?utm_source=chatgpt.com" title="Settings"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/universes/settings?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
</ul>
<h3 id="1-pre-trade">(1) Pre-Trade 검증</h3>
<ol>
<li><strong>시장 시간</strong> 체크: <code>Security.Exchange.Hours</code>에서 현재 시각에 거래 가능한지, 연장장 제한 등 확인. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/securities/market-hours?utm_source=chatgpt.com" title="Market Hours"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/securities/market-hours?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>호가단위·로트·최소수량</strong> 맞춤 라운딩/거부: <code>SymbolProperties</code> 참조. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SymbolProperties.html?utm_source=chatgpt.com" title="QuantConnect.Securities.SymbolProperties Class Reference"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SymbolProperties.html?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>Buying Power</strong> 확인: 주문가치·증거금 사용량·유휴율(RequiredFreeBuyingPowerPercent) 판정. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/buying-power?utm_source=chatgpt.com" title="Buying Power"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/buying-power?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.lean.io/docs/v2/lean-engine/class-reference/IBrokerageModel_8cs_source.html?utm_source=chatgpt.com" title="Common/Brokerages/IBrokerageModel.cs Source File"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/IBrokerageModel_8cs_source.html?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>공매도 가능수량</strong> 확인(숏이면): <code>IShortableProvider</code> 조회. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IShortableProvider.html?utm_source=chatgpt.com" title="QuantConnect.Interfaces. IShortableProvider ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IShortableProvider.html?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>브로커 특화 제한</strong>: IBKR 예) 연장장 특정 주문 비허용 등 <code>CanExecuteOrder</code>. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Brokerages_1_1InteractiveBrokersBrokerageModel.html?utm_source=chatgpt.com" title="Lean: QuantConnect.Brokerages. ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Brokerages_1_1InteractiveBrokersBrokerageModel.html?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
</ol>
<h3 id="2-execution">(2) Execution(체결 산출)</h3>
<ul>
<li><strong>FillModel</strong>로 주문타입별 체결가/수량 결정(호가/틱·바 활용, 옥션가격 가능). 이어서 <strong>SlippageModel</strong>로 슬리피지 가산. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/trade-fills/key-concepts?utm_source=chatgpt.com" title="Trade Fills"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/trade-fills/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
</ul>
<h3 id="3-post-trade">(3) Post-Trade 회계 처리</h3>
<ul>
<li><strong>FeeModel</strong>로 수수료 차감 → <strong>SettlementModel</strong>이 정해진 스케줄로 현금 반영 → <strong>MarginInterest</strong> 일할 적용 → <strong>CashBook</strong> 다통화 반영. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/transaction-fees/key-concepts?utm_source=chatgpt.com" title="Transaction Fees"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/transaction-fees/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
</ul>
<blockquote>
<p>이 전체를 브로커별 <strong>Profile</strong>(예: IBKR, Coinbase, Binance …)로 미리 묶어 두고, 전략에서 <code>SetBrokerageModel(BrokerageName.X, AccountType.Y)</code>처럼 선택만 하게 하는 것이 Lean의 사용성 포인트입니다. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/brokerages/supported-models/interactive-brokers?utm_source=chatgpt.com" title="Interactive Brokers"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/brokerages/supported-models/interactive-brokers?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</blockquote>
<hr />
<h2 id="4">4) 브로커리지 프로파일 설계 체크리스트(기술 포인트)</h2>
<ol>
<li>
<p><strong>SymbolProperties/DB 연동</strong></p>
</li>
<li>
<p>틱사이즈·로트·최소주문·계약승수: 가격/수량 라운딩과 제한 체크의 기준값. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SymbolProperties.html?utm_source=chatgpt.com" title="QuantConnect.Securities.SymbolProperties Class Reference"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SymbolProperties.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>시장시간 캘린더</strong></p>
</li>
<li>
<p><code>SecurityExchangeHours</code> + <code>MarketHoursDatabase</code>를 통한 정규/연장장·조기폐장·휴장. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html?utm_source=chatgpt.com" title="QuantConnect.Securities.SecurityExchangeHours Class ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>Buying Power/Margin</strong></p>
</li>
<li>
<p>계좌 타입별(BuyingPowerModel) + 브로커 유휴율(IBrokerageModel) 조합. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/buying-power?utm_source=chatgpt.com" title="Buying Power"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/buying-power?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.lean.io/docs/v2/lean-engine/class-reference/IBrokerageModel_8cs_source.html?utm_source=chatgpt.com" title="Common/Brokerages/IBrokerageModel.cs Source File"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/IBrokerageModel_8cs_source.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>Fill/Slippage/Fee의 결합 순서</strong></p>
</li>
<li>
<p>Fill → Slippage(체결가 조정) → Fee(현금 차감). 모델은 종목 단위로 세팅(필요 시 커스텀). (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/trade-fills/key-concepts?utm_source=chatgpt.com" title="Trade Fills"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/trade-fills/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>Settlement &amp; CashBook</strong></p>
</li>
<li>
<p>시간 경과형 정산(Scan/ApplyFunds) + 다통화 잔고/환전 반영. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/settlement/key-concepts?utm_source=chatgpt.com" title="Settlement"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/settlement/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>Short Availability</strong></p>
</li>
<li>
<p>공매도 가능 수량/비용 미존재 시 주문 거부. 데이터셋 연동 옵션. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/short-availability/key-concepts?utm_source=chatgpt.com" title="Short Availability"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/short-availability/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>Order Properties/TIF</strong></p>
</li>
<li>
<p>IOC/FOK/GTD 등의 만기 규칙과 브로커 기본값 제공. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/trading-and-orders/order-properties?utm_source=chatgpt.com" title="Order Properties - QuantConnect.com"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/trading-and-orders/order-properties?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Orders_1_1TimeInForce.html?utm_source=chatgpt.com" title="QuantConnect.Orders.TimeInForce Class Reference - LEAN"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Orders_1_1TimeInForce.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
<li>
<p><strong>브로커 고유 제한</strong></p>
</li>
<li>
<p>예: 연장장 체결 불가, 특정 자산 미지원 → <code>CanExecuteOrder</code> 같은 훅에서 일괄 판정. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Brokerages_1_1InteractiveBrokersBrokerageModel.html?utm_source=chatgpt.com" title="Lean: QuantConnect.Brokerages. ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Brokerages_1_1InteractiveBrokersBrokerageModel.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</li>
</ol>
<hr />
<h2 id="5-qmtl">5) QMTL에 이식할 때의 모듈 배치(권장 아키텍처)</h2>
<blockquote>
<p>목표: DAG 순수성 해치지 않으면서 <strong>브로커리지 프로파일</strong>을 한 번에 주입.</p>
</blockquote>
<p><strong>① BrokerageProfile (전역 구성체)</strong></p>
<ul>
<li>내부에 하위 모델들을 보유:
  <code>{ FillModel, SlippageModel, FeeModel, BuyingPowerModel, SettlementModel, ShortableProvider, MarginInterestModel, ExchangeHoursProvider, SymbolPropertiesProvider, OrderProperties }</code></li>
<li>전략 시작 시 <strong>SecurityInitializer</strong> 역할로 각 종목에 주입. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/universes/settings?utm_source=chatgpt.com" title="Settings"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/universes/settings?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
</ul>
<p><strong>② ExecutionNode (DAG 노드)</strong></p>
<ul>
<li>입력: 주문, 시세(틱/바), 프로파일</li>
<li>단계: Pre-Trade 검증 → Fill → Slippage → Fee → 이벤트 출력</li>
<li>옵션: <strong>IOC/FOK</strong> 즉시 취소, <strong>volume-limit</strong>(부분체결) 등 현실화 규칙</li>
</ul>
<p><strong>③ Portfolio/CashBook Service (러너 단계 또는 별도 노드)</strong></p>
<ul>
<li>Settlement 주기와 Margin Interest를 <strong>시간 스케줄</strong>에 따라 적용</li>
<li>다통화 <strong>CashBook</strong> 업데이트 및 환산 가치 계산 (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/portfolio/cashbook?utm_source=chatgpt.com" title="Cashbook"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/portfolio/cashbook?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
</ul>
<p><strong>④ ShortableProvider (서비스/캐시)</strong></p>
<ul>
<li>종목·날짜별 대차 가능 수량 제공(없으면 숏 주문 거부). (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IShortableProvider.html?utm_source=chatgpt.com" title="QuantConnect.Interfaces. IShortableProvider ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IShortableProvider.html?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
</ul>
<p><strong>⑤ ExchangeHours/Calendar Provider</strong></p>
<ul>
<li>장 개폐/연장장/휴장 캘린더 조회로 주문 타임 윈도우 통제. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html?utm_source=chatgpt.com" title="QuantConnect.Securities.SecurityExchangeHours Class ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
</ul>
<hr />
<h2 id="6-ibkr">6) 예시: <strong>IBKR 프로파일</strong> 구성 레시피</h2>
<ul>
<li><strong>BuyingPower</strong>: 마진/현금 계좌별 모델 + 유휴율 세팅(브로커리지 모델). (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/buying-power?utm_source=chatgpt.com" title="Buying Power"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/buying-power?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.lean.io/docs/v2/lean-engine/class-reference/IBrokerageModel_8cs_source.html?utm_source=chatgpt.com" title="Common/Brokerages/IBrokerageModel.cs Source File"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/IBrokerageModel_8cs_source.html?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>Fill</strong>: Equity/Futures 기본 FillModel(개장·폐장 옥션 가격 지원) 사용. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/trade-fills/key-concepts?utm_source=chatgpt.com" title="Trade Fills"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/trade-fills/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>Slippage</strong>: 거래량 기반 또는 스프레드 기반 프리셋 중 선택. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/slippage/key-concepts?utm_source=chatgpt.com" title="Slippage"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/slippage/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>Fee</strong>: IBKR 수수료 모델 사용(티어·최소수수료 등). (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/transaction-fees/key-concepts?utm_source=chatgpt.com" title="Transaction Fees"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/transaction-fees/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>Settlement</strong>: 주식 T+2/T+1 등 정산 규칙 모델. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/settlement/supported-models?utm_source=chatgpt.com" title="Supported Models"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/settlement/supported-models?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>Short</strong>: US Short Availability 데이터로 대차 가능 수량 적용. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/datasets/quantconnect/us-equities-short-availability?utm_source=chatgpt.com" title="US Equities Short Availability"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/datasets/quantconnect/us-equities-short-availability?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>Hours</strong>: 거래소 캘린더/연장장 제한(IBKR 모델의 <code>CanExecuteOrder</code>) 적용. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Brokerages_1_1InteractiveBrokersBrokerageModel.html?utm_source=chatgpt.com" title="Lean: QuantConnect.Brokerages. ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Brokerages_1_1InteractiveBrokersBrokerageModel.html?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
</ul>
<hr />
<h2 id="7-poc">7) 구현 순서(POC 체크리스트)</h2>
<ol>
<li><strong>Symbol/Hours Provider</strong>(틱사이즈·로트·캘린더) → 주문 검증 통과율 테스트. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SymbolProperties.html?utm_source=chatgpt.com" title="QuantConnect.Securities.SymbolProperties Class Reference"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/classQuantConnect_1_1Securities_1_1SymbolProperties.html?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>BuyingPowerModel</strong> → 최대가능수량 API/유휴율 적용 단위테스트. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Securities_1_1IBuyingPowerModel.html?utm_source=chatgpt.com" title="QuantConnect.Securities.IBuyingPowerModel Interface ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Securities_1_1IBuyingPowerModel.html?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>Fill/Slippage/Fee</strong> → 체결 이벤트에 슬리피지/수수료 반영 여부 검증. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/trade-fills/key-concepts?utm_source=chatgpt.com" title="Trade Fills"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/trade-fills/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>Settlement/Margin Interest</strong> → 시간 경과형 현금흐름 시뮬레이션. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/settlement/key-concepts?utm_source=chatgpt.com" title="Settlement"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/settlement/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>ShortableProvider</strong> → 숏 거부/허용 케이스 회귀 테스트. (<a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IShortableProvider.html?utm_source=chatgpt.com" title="QuantConnect.Interfaces. IShortableProvider ..."><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IShortableProvider.html?utm_source=chatgpt.com">QuantConnect</a></a>)</li>
<li><strong>통합 파이프라인 시나리오</strong>(정규/연장장, IOC/FOK, 최소수량·틱사이즈 위반, 대규모 주문 등) 엔드투엔드 테스트.</li>
</ol>
<hr />
<h3 id="_2">마무리</h3>
<p>Lean의 브로커리지 모델은 **“브로커별 현실 모델 번들 + 사전 검증 훅”**입니다. 위 블록(모델·프로바이더·캘린더·캐시북)을 <strong>BrokerageProfile</strong>로 묶고, <strong>SecurityInitializer</strong>를 통해 종목에 일괄 주입하면, QMTL에서도 <strong>브로커 현황에 맞는 체결·비용·정산·제약</strong>을 한 번에 재현할 수 있습니다. 실거래 연동까지 확장하려면 <code>IBrokerage</code>에 해당하는 **거래/데이터 핸들러(브로커 커넥터)**를 덧붙이면 됩니다. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/universes/settings?utm_source=chatgpt.com" title="Settings"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/universes/settings?utm_source=chatgpt.com">QuantConnect</a></a>, <a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IBrokerage.html?utm_source=chatgpt.com" title="QuantConnect.Interfaces.IBrokerage Interface Reference"><a href="https://www.lean.io/docs/v2/lean-engine/class-reference/interfaceQuantConnect_1_1Interfaces_1_1IBrokerage.html?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
<blockquote>
<p>참고: 각 항목의 상세 동작·예제·사전구현 모델 목록은 Lean 공식 문서의 <strong>Reality Modeling</strong> 섹션(매수력/체결/슬리피지/수수료/정산/공매도)과 <strong>Brokerages</strong> 섹션(IBKR 등)을 보시면 신속히 구현 스펙을 확정할 수 있습니다. (<a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/key-concepts?utm_source=chatgpt.com" title="Reality Modeling"><a href="https://www.quantconnect.com/docs/v2/writing-algorithms/reality-modeling/key-concepts?utm_source=chatgpt.com">QuantConnect</a></a>)</p>
</blockquote>
<p>If you want, I can sketch a minimal <strong>IBKR-like BrokerageProfile POC</strong>(파이썬 의사코드)로 실행 순서(Pre→Fill→Slip→Fee→Settle)를 보여드릴게요.</p>
<hr />
<h2 id="integration-note-worlds-and-brokerage">Integration Note: Worlds and Brokerage</h2>
<ul>
<li>Activation vs. Execution: WorldService decides whether a strategy/side may trade (activation set). Brokerage models define how orders are validated and executed once allowed.</li>
<li>Separation of concerns: Gateway/SDK enforce world activation via an order gate before invoking brokerage logic. Brokerage does not determine activation and remains broker‑specific.</li>
<li>Safety: If activation is stale/unknown, orders are gated OFF regardless of brokerage model outcomes.</li>
</ul>
<h3 id="qmtl-module-mapping-implementation-pointers">QMTL Module Mapping (Implementation Pointers)</h3>
<ul>
<li>Orders &amp; TIF: <code>qmtl/brokerage/order.py</code> (<code>OrderType</code>, <code>TimeInForce</code>, extended <code>Order</code>)</li>
<li>Fill: <code>qmtl/brokerage/fill_models.py</code> (market/limit/stop/stop-limit + IOC/FOK)</li>
<li>Slippage: <code>qmtl/brokerage/slippage.py</code> (null/constant/spread/volume-share)</li>
<li>Fees: <code>qmtl/brokerage/fees.py</code> (percent/per-share/composite)</li>
<li>Symbol properties: <code>qmtl/brokerage/symbols.py</code> (tick/lot/min validation)</li>
<li>Exchange hours: <code>qmtl/brokerage/exchange_hours.py</code> (regular/pre/post; holiday support is incremental)</li>
<li>Shortable: <code>qmtl/brokerage/shortable.py</code> (default static provider)</li>
<li>Profiles/Initializer: <code>qmtl/brokerage/profile.py</code> (<code>ibkr_equities_like_profile()</code>)</li>
<li>Settlement &amp; Interest: <code>qmtl/brokerage/settlement.py</code>, <code>qmtl/brokerage/interest.py</code> (skeletons)</li>
<li>SDK Gate: <code>qmtl/sdk/order_gate.py</code> (activation gate helper)</li>
</ul>
<p>See also: Reference API at <code>docs/reference/api/brokerage.md</code>.</p>
<p><strong>Related:</strong> <a href="../">Overview</a>, <a href="../architecture/">Architecture &amp; Ownership</a>, <a href="../glossary/">Glossary</a>, <a href="../dag-manager/">DAG Manager</a>, <a href="../gateway/">Gateway</a>, <a href="../worldservice/">World Service</a>, <a href="../controlbus/">ControlBus</a>, <a href="./">Lean Brokerage Model</a>, <a href="../../reference/api/brokerage/">Brokerage API</a>, <a href="../implementation_todos/">Implementation TODOs</a></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "navigation.expand", "navigation.path"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>