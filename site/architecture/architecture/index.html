
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="QMTL Team">
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../glossary/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>QMTL 고급 아키텍처 및 시스템 구현 계획서 - QMTL Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#qmtl" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="QMTL Documentation" class="md-header__button md-logo" aria-label="QMTL Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QMTL Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              QMTL 고급 아키텍처 및 시스템 구현 계획서
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="QMTL Documentation" class="md-nav__button md-logo" aria-label="QMTL Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    QMTL Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MAINTENANCE_SCHEDULE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maintenance Schedule
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Architecture & Ownership
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Architecture & Ownership
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      관련 문서
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0" class="md-nav__link">
    <span class="md-ellipsis">
      0. 개요: 이론적 동기와 시스템화의 목적
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 시스템 구성: 계층 간 상호작용과 처리 흐름
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-" class="md-nav__link">
    <span class="md-ellipsis">
      2. 전략 상태 전이 시나리오와 원인-결과 연쇄
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 구조적 기술 설계 및 메타 모델링 개선 제안
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 구조적 기술 설계 및 메타 모델링 개선 제안">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 다중 업스트림을 갖는 노드의 시간 기반 데이터 처리 모델
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.1 다중 업스트림을 갖는 노드의 시간 기반 데이터 처리 모델">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      이론적 배경
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4d-tensor-model" class="md-nav__link">
    <span class="md-ellipsis">
      구조 정의 (4‑D Tensor Model)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      설계 요구사항 요약
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      런타임 처리 절차
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yaml" class="md-nav__link">
    <span class="md-ellipsis">
      전략 설정 예시 (YAML)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      설계 영감
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tagbased-multiupstream" class="md-nav__link">
    <span class="md-ellipsis">
      Tag‑based Multi‑Upstream 큐 자동 매핑
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-p0" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 운영 신뢰성과 결정성 강화 (P0 제안 요약)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 실행 모드 및 구성요소 역할
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. 실행 모드 및 구성요소 역할">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 전략 실행 모드
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runner-api" class="md-nav__link">
    <span class="md-ellipsis">
      부록: 일반 전략 예시 코드 (Runner API 적용)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="부록: 일반 전략 예시 코드 (Runner API 적용)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tag-query-strategy-upstream" class="md-nav__link">
    <span class="md-ellipsis">
      부록: Tag Query Strategy 예시 (다중 Upstream 자동 선택)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crossmarket-lag-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      부록: 교차 시장 전략 예시 (Cross‑Market Lag Strategy)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. 구성요소 역할 및 기술 스택
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ownership-model" class="md-nav__link">
    <span class="md-ellipsis">
      Ownership Model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commit-log-design" class="md-nav__link">
    <span class="md-ellipsis">
      Commit-Log Design
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-deterministic-checklist-v09" class="md-nav__link">
    <span class="md-ellipsis">
      6. Deterministic Checklist (v0.9)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dag-manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DAG Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gateway
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../worldservice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    World Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../controlbus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ControlBus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lean_brokerage_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lean Brokerage Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/brokerage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Brokerage API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../implementation_todos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementation TODOs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/sdk_tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SDK Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/strategy_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Strategy Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/backfill/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backfill
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/canary_rollout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Canary Rollout
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/e2e_testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    E2E Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/activation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    World Activation Runbook
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/risk_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Risk Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/timing_controls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timing Controls
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/schemas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Schemas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api_world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    World API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/enhanced_validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enhanced Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/backtest_validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backtest Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/lean_like_features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lean-like Features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/brokerage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Brokerage API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/_inventory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inventory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    World
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            World
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../world/world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../world/realm_rename_eval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Realm Terminology Evaluation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../templates/template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Template
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      관련 문서
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0" class="md-nav__link">
    <span class="md-ellipsis">
      0. 개요: 이론적 동기와 시스템화의 목적
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 시스템 구성: 계층 간 상호작용과 처리 흐름
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-" class="md-nav__link">
    <span class="md-ellipsis">
      2. 전략 상태 전이 시나리오와 원인-결과 연쇄
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 구조적 기술 설계 및 메타 모델링 개선 제안
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 구조적 기술 설계 및 메타 모델링 개선 제안">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 다중 업스트림을 갖는 노드의 시간 기반 데이터 처리 모델
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.1 다중 업스트림을 갖는 노드의 시간 기반 데이터 처리 모델">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      이론적 배경
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4d-tensor-model" class="md-nav__link">
    <span class="md-ellipsis">
      구조 정의 (4‑D Tensor Model)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      설계 요구사항 요약
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      런타임 처리 절차
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yaml" class="md-nav__link">
    <span class="md-ellipsis">
      전략 설정 예시 (YAML)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      설계 영감
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tagbased-multiupstream" class="md-nav__link">
    <span class="md-ellipsis">
      Tag‑based Multi‑Upstream 큐 자동 매핑
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-p0" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 운영 신뢰성과 결정성 강화 (P0 제안 요약)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 실행 모드 및 구성요소 역할
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. 실행 모드 및 구성요소 역할">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 전략 실행 모드
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runner-api" class="md-nav__link">
    <span class="md-ellipsis">
      부록: 일반 전략 예시 코드 (Runner API 적용)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="부록: 일반 전략 예시 코드 (Runner API 적용)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tag-query-strategy-upstream" class="md-nav__link">
    <span class="md-ellipsis">
      부록: Tag Query Strategy 예시 (다중 Upstream 자동 선택)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crossmarket-lag-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      부록: 교차 시장 전략 예시 (Cross‑Market Lag Strategy)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. 구성요소 역할 및 기술 스택
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ownership-model" class="md-nav__link">
    <span class="md-ellipsis">
      Ownership Model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commit-log-design" class="md-nav__link">
    <span class="md-ellipsis">
      Commit-Log Design
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-deterministic-checklist-v09" class="md-nav__link">
    <span class="md-ellipsis">
      6. Deterministic Checklist (v0.9)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
        <a href="../../tags/#tag:architecture" class="md-tag">architecture</a>
      
    
      
      
      
        <a href="../../tags/#tag:design" class="md-tag">design</a>
      
    
  </nav>



<p><a href="/">Home</a> / <a href="/architecture">architecture</a> / <a href="/architecture/architecture">architecture</a>
<strong>Related:</strong> <a href="../">Overview</a>, <a href="./">Architecture &amp; Ownership</a>, <a href="../glossary/">Glossary</a>, <a href="../dag-manager/">DAG Manager</a>, <a href="../gateway/">Gateway</a>, <a href="../worldservice/">World Service</a>, <a href="../controlbus/">ControlBus</a>, <a href="../lean_brokerage_model/">Lean Brokerage Model</a>, <a href="../../reference/api/brokerage/">Brokerage API</a>, <a href="../implementation_todos/">Implementation TODOs</a></p>
<h1 id="qmtl">QMTL 고급 아키텍처 및 시스템 구현 계획서</h1>
<h2 id="_1">관련 문서</h2>
<ul>
<li><a href="../">Architecture Overview</a></li>
<li><a href="../gateway/">Gateway</a></li>
<li><a href="../dag-manager/">DAG Manager</a></li>
<li><a href="../lean_brokerage_model/">Lean Brokerage Model</a></li>
<li><a href="../worldservice/">WorldService</a></li>
<li><a href="../controlbus/">ControlBus</a></li>
</ul>
<hr />
<h2 id="0">0. 개요: 이론적 동기와 시스템화의 목적</h2>
<p>QMTL은 전략 기반 데이터 흐름 처리 시스템으로, 복잡한 계산 DAG(Directed Acyclic Graph)를 효율적으로 실행하고, 반복적 계산을 피하면서 재사용 가능한 컴퓨팅 자원을 최대한 활용하는 것을 주요 목표로 한다. 특히 DAG의 구성요소를 연산 단위로 분해하고 이를 전역적으로 식별·재활용할 수 있도록 함으로써, 유사하거나 동일한 전략 간에 불필요한 계산 자원 낭비를 최소화할 수 있다. 예를 들어 A 전략과 B 전략이 공통적으로 사용하는 가격 신호 처리 노드가 있다면, 해당 노드는 한 번만 실행되고 그 결과는 두 전략에서 모두 참조할 수 있게 된다. 이는 고빈도 실행 환경 또는 다중 전략 포트폴리오 환경에서 시간 복잡도와 메모리 사용량을 획기적으로 줄이는 데 기여한다.</p>
<p>본 문서는 이러한 구조적 재사용성을 달성하기 위한 QMTL 아키텍처의 설계 철학, 계층 구조 정의, 컴포넌트 간의 통신 프로토콜, 상태 복원 메커니즘, 큐 오케스트레이션에 필요한 결정론적 조건들을 이론적·실무적 관점에서 조망하며, 전체 시스템 구현을 위한 종합적 로드맵을 제시한다.</p>
<hr />
<h2 id="1">1. 시스템 구성: 계층 간 상호작용과 처리 흐름</h2>
<pre><code class="language-mermaid">graph LR
  subgraph Client
    SDK[SDK / Runner]
  end
  subgraph Edge
    GW[Gateway]
  end
  subgraph Core
    WS[WorldService (SSOT Worlds)]
    DM[DAG Manager (SSOT Graph)]
    CB[(ControlBus — internal)]
    GDB[(Graph DB)]
    KQ[(Kafka/Redpanda)]
  end

  SDK -- HTTP submit/queues/worlds --&gt; GW
  GW -- proxy --&gt; WS
  GW -- proxy --&gt; DM
  DM --&gt; GDB
  DM --&gt; KQ
  WS -- publish --&gt; CB
  DM -- publish --&gt; CB
  GW -- subscribe --&gt; CB
  GW -- WS (opaque) --&gt; SDK
</code></pre>
<ol>
<li><strong>SDK</strong>는 전략을 DAG로 직렬화하고 Gateway에 제출/질의한다. 실행 중에는 Gateway의 WS로부터 불투명(ControlBus 기반) 이벤트 스트림을 전달받아 활성/큐 변경을 반영한다.</li>
<li><strong>Gateway</strong>는 외부 단일 접점으로서 WorldService/DAG Manager를 프록시하고, 캐시/서킷/관측을 담당한다. 또한 ControlBus를 구독하여 SDK로 이벤트를 재전송한다.</li>
<li><strong>WorldService</strong>는 월드/정책/결정/활성의 SSOT이며, 결정·활성 업데이트를 ControlBus에 발행한다.</li>
<li><strong>DAG Manager</strong>는 그래프/노드/큐의 SSOT이며, Diff와 큐 오케스트레이션을 수행하고 QueueUpdated 이벤트를 ControlBus에 발행한다.</li>
<li><strong>SDK</strong>는 반환된 큐 매핑에 따라 로컬에서 필요한 노드만 실행하며, 활성 게이트(OrderGateNode)로 주문 발동을 제어한다.</li>
</ol>
<p>이 구조는 DAG의 구성요소 단위 재사용을 통해 시간복잡도와 자원 소비를 최소화하며, DAG 전체가 아닌 부분 연산 재활용을 통해 글로벌 최적화를 달성한다.</p>
<hr />
<h2 id="2-">2. 전략 상태 전이 시나리오와 원인-결과 연쇄</h2>
<table>
<thead>
<tr>
<th>시나리오 유형</th>
<th>1차 원인</th>
<th>2차 시스템 반응</th>
<th>3차 결과 및 해석</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>낙관적</strong></td>
<td>동일 연산 해시 재사용 가능</td>
<td>DAG Diff 결과 일부 노드 실행 불필요</td>
<td>리소스 최적화, 전략 처리 시간 단축</td>
</tr>
<tr>
<td><strong>중립적</strong></td>
<td>동시 큐 생성 요청</td>
<td>Kafka의 Idempotent API 동작</td>
<td>중복 큐 생성 회피, 트랜잭션 정합성 유지</td>
</tr>
<tr>
<td><strong>비관적</strong></td>
<td>Gateway의 Redis 상태 유실</td>
<td>복구 불가능한 상태 손실 위험</td>
<td>AOF 및 PostgreSQL Write-Ahead Logging 활용 복구 수행</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="3">3. 구조적 기술 설계 및 메타 모델링 개선 제안</h2>
<ol>
<li>
<p><strong>결정적 노드 식별자(NodeID)</strong> :</p>
</li>
<li>
<p>구성: <code>(node_type, code_hash, config_hash, schema_hash)</code></p>
</li>
<li>해시 알고리즘: SHA-256 → 충돌 감지 시 SHA-3 fallback</li>
<li><strong>버전 감시 노드(Version Sentinel)</strong> : Gateway가 DAG를 수신한 직후 <strong>자동으로 1개의 메타 노드</strong>를 삽입해 "버전 경계"를 표시한다. SDK·전략 작성자는 이를 직접 선언하거나 관리할 필요가 없으며, 오로지 <strong>운영·배포 레이어</strong>에서 롤백·카나리아 트래픽 분배, 큐 정합성 검증을 용이하게 하기 위한 인프라 내부 기능이다. Node‑hash만으로도 큐 재사용 판단은 가능하므로, 소규모·저빈도 배포 환경에서는 Sentinel 삽입을 비활성화(옵션)할 수 있다.
   자세한 카나리아 트래픽 조절 방법은 <a href="../../operations/canary_rollout/">Canary Rollout Guide</a>에서 설명한다.</li>
<li><strong>CloudEvents 기반 이벤트 스펙 도입</strong> : 표준 이벤트 정의를 통해 시스템 확장성과 언어 독립성을 확보</li>
<li><strong>상태 머신 기반 실행 제어(xState)</strong> : 전략 상태 흐름을 Finite-State-Machine으로 모델링하여 이론 검증 가능성과 시각화 용이성 확보</li>
<li><strong>Ray 기반 병렬 처리</strong> : 병렬 실행 시 Python multiprocessing을 Ray로 대체하여 메모리 격리성과 클러스터 확장성을 보장</li>
<li><strong>관측성(Observability) 강화</strong> : Prometheus, Grafana, Kafka Exporter, Neo4j APOC 프로파일러 기반의 지표 수집 및 병목 분석</li>
</ol>
<hr />
<h3 id="31">3.1 다중 업스트림을 갖는 노드의 시간 기반 데이터 처리 모델</h3>
<h4 id="_2">이론적 배경</h4>
<p>노드가 수신하는 다수의 업스트림 큐는 각기 다른 시간 해상도(interval)를 갖는다. 이로 인해 노드는 일정 기간(period) 동안의 데이터 윈도우를 유지하며 연산을 수행해야 한다.</p>
<h4 id="4d-tensor-model">구조 정의 (4‑D Tensor Model)</h4>
<table>
<thead>
<tr>
<th>축 (axis)</th>
<th>의미</th>
<th>예시</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>u – upstream_id</strong></td>
<td>태그 또는 큐 ID (인터벌 포함)</td>
<td><code>btc_price_binance</code>, <code>eth_price_binance</code></td>
</tr>
<tr>
<td><strong>i – interval</strong></td>
<td>데이터 수신 간격 (초·분·시) <strong>– 노드 필수</strong></td>
<td><code>60s</code>, <code>5m</code>, <code>1h</code></td>
</tr>
<tr>
<td><strong>p – period slot</strong></td>
<td>롤링 윈도우 인덱스 $0 … P<sub>i</sub>−1$</td>
<td><code>0‑29</code> (30 bars)</td>
</tr>
<tr>
<td><strong>f – feature index</strong></td>
<td><code>"t"</code>(버킷 타임스탬프) 또는 <code>"v"</code>(값)</td>
<td><code>"t"</code>, <code>"v"</code></td>
</tr>
</tbody>
</table>
<ul>
<li><strong>데이터 구조</strong>: 4‑D xarray 또는 PyArrow Tensor <code>C[u,i,p,f]</code> 로 구현.</li>
<li><strong>메모리 가드레일</strong>: period × interval 초과 영역은 슬라이스 단위로 즉시 evict하며,
  Tensor 슬라이스는 Apache Arrow chunk로 매핑해 zero‑copy 전달한다. GC 작업은 Ray
  Actor로 분리 스케줄링한다.</li>
<li><strong>Arrow 캐시 백엔드 옵션</strong>: 환경 변수 <code>QMTL_ARROW_CACHE=1</code>을 설정하면 PyArrow 기반
  캐시가 활성화됩니다. <code>QMTL_CACHE_EVICT_INTERVAL</code> 값으로 만료 슬라이스를 검사하는
  주기를 조정하며, Ray가 설치되어 있으면 eviction 로직이 Ray Actor로 실행됩니다.
  CLI의 <code>--no-ray</code> 옵션으로 비활성화할 수 있습니다.</li>
<li><strong>다중 인터벌·다중 업스트림 지원</strong>: <code>u</code> 축 (업스트림)과 <code>i</code> 축 (인터벌)을 분리함으로써 1m·5m·1h 등 다양한 간격과 여러 태그 큐를 동시에 저장·검색 가능.</li>
<li><strong>캐시 채우기 규칙</strong>: 노드는 <code>∀(u,i) : |C[u,i]| ≥ Pᵢ</code> 조건을 만족할 때에만 프로세싱 함수가 호출된다.</li>
<li><strong>타임스탬프 정렬 예시</strong>: interval = 1 m, period = 10, 시스템 UTC = 10:10:30 ⇒ <code>f="t"</code> 슬롯에는 10:01 … 10:10(10개 캔들)이 저장된다.</li>
<li><strong>결측 처리</strong>: 캔들 누락 시 <code>missing_flag</code> ↦ 재동기화 요청 또는 <code>on_missing</code> 정책(<code>skip</code>/<code>fail</code>) 적용.</li>
<li><strong>타임스탬프 버킷팅</strong>: NodeCache는 타임스탬프 입력 전에 <code>timestamp - (timestamp % interval)</code> 값을 적용해 저장하며 gap 검출도 버킷 값에 기반한다.</li>
</ul>
<h4 id="_3">설계 요구사항 요약</h4>
<ol>
<li><strong>필수 <code>interval</code> 필드</strong> — 모든 <code>Node</code> 메타 정의에 <code>interval</code>을 <strong>필수 (primary key)</strong> 로 포함한다. 예) <code>interval: 1m</code>, <code>5m</code>, <code>1h</code>. 정수(초)나 문자열 형식(<code>"1h"</code>, <code>"30m"</code>, <code>"45s"</code>) 모두 허용된다.</li>
<li><strong>업스트림 데이터 캐시</strong> — 3‑D 맵 대신 4‑D Tensor <code>C[u,i,p,f]</code> 구조를 사용한다. 축 정의는 위 표를 참조하며, 큐 인서트는 벡터 단위·만료는 FIFO pop으로 수행된다.</li>
<li><strong>프로세싱 함수(Compute-Fn) 규약</strong> — 노드의 계산 함수는 순수 함수로, <code>data_cache</code> 외부 상태를 읽거나 쓰지 않는다. 모든 <code>compute_fn</code>은 <code>NodeCache.view()</code>이 반환하는 <strong>read-only CacheView</strong> 한 개만을 인자로 받으며, I/O(큐 publish, DB write) 역시 금지.</li>
</ol>
<p><code>python
   def fn(view) -&gt; pd.DataFrame:
           ...</code>
4. <strong>Period 충족 조건</strong> — 노드 트리거 공식: <code>∀ u ∈ upstreams : len(view[u][interval]) ≥ period</code>.
5. <strong>시간축 정의</strong> — 타임스탬프 인덱스 <code>t = floor(epoch / interval)</code> 로 정규화한다. 예) interval = 1 m, period = 10, 시스템 시각 10:10:30 → 요구 인덱스 10:01 … 10:10.
6. <strong>데이터 유효성 체크</strong> — 삽입 시 Δt ≠ interval 이면 <code>missing_flag</code> 설정 후 재동기화 요청(<code>on_missing</code>).
7. <strong>설정 DSL 스케치</strong> — YAML 예시:</p>
<p><code>yaml
   nodes:
     - id: rsi_1m
       interval: 1m
       period: 14
       compute: ta.rsi
     - id: corr_1h
       interval: 1h
       period: 10
       upstream_query:
         tags: ["ta-indicator"]
       compute: stats.corr</code></p>
<ol>
<li><strong>실행 흐름 분리</strong> — <code>Node.feed</code> 는 데이터를 캐시에 저장만 하고,
   필요한 데이터가 모이면 <code>True</code> 를 반환해 Runner 에게 계산을 위임한다.
   이로써 <code>Node</code> 는 <code>Runner</code> 에 의존하지 않으므로 테스트가 한층 용이하다.</li>
</ol>
<h4 id="_4">런타임 처리 절차</h4>
<pre><code class="language-mermaid">flowchart LR
    subgraph UpstreamData
        U1[&quot;Upstream Queue u₁&lt;br/&gt;(interval 1 m)&quot;]
        U2[&quot;Upstream Queue u₂&lt;br/&gt;(interval 5 m)&quot;]
    end
    U1 --&gt;|append| C[&quot;4‑D Cache C[u,i,p,f]&quot;]
    U2 --&gt;|append| C
    C --&gt;|period Pᵢ satisfied?| FN[/&quot;Processing&amp;nbsp;Function&lt;br/&gt;fn(view)&quot;/]
    FN --&gt; OUT[&quot;Node Output&lt;br/&gt;(→ downstream or queue)&quot;]
    classDef dim fill:#f8f8f8,stroke:#333,stroke-width:1px;
    class C dim;
</code></pre>
<ol>
<li>Gateway는 DAG 제출 시 각 노드에 대해 interval/period 세팅을 판단</li>
<li>SDK는 지정된 upstream별로 CircularBuffer를 생성</li>
<li>큐로부터 FIFO 방식으로 데이터를 수신하며, period 범위 내에서 평균(mean), 표준편차(std), 이동 최소값(min), 상관계수 계산(corr), 사용자 정의 지표 연산 등 다양한 시계열 통계 처리를 수행</li>
</ol>
<h4 id="yaml">전략 설정 예시 (YAML)</h4>
<pre><code class="language-yaml">upstream_settings:
  - interval: 60
    period: 30
  - interval: 300
    period: 12
</code></pre>
<h4 id="_5">설계 영감</h4>
<p>TimeScaleDB의 Continuous Aggregates 원리를 연산 캐시 계층에 적용하여, 정해진 시간 해상도에서 미리 정의된 집계 쿼리를 지속적으로 갱신하는 방식과 유사하게, QMTL에서도 interval 및 period에 따라 각 노드가 사용하는 데이터를 미리 캐시하고 업데이트하여 연산 효율성을 높이는 구조를 구현하였다. 특히 TimeScaleDB가 materialized view에 기반해 결과를 지속적으로 갱신하는 것처럼, QMTL은 각 전략 노드가 필요로 하는 데이터 범위를 미리 지정된 기간 동안 유지·갱신함으로써 연산 지연을 줄이고 처리 속도를 극대화한다. 이때 '지정된 기간'은 각 노드의 업스트림별로 설정된 <code>period × interval</code> 계산에 기반하여 결정되며, 사용자는 전략 구성 시 노드 단위로 별도의 period 값을 지정하거나, 시스템이 interval별로 제공하는 기본값 테이블에 따라 자동 보간된다. 또한 QMTL은 런타임 중 전략의 상태나 데이터 도달률에 따라 해당 기간의 설정을 제한 범위 내에서 동적으로 조정할 수 있는 기능도 제공하여, 네트워크나 데이터 품질 변화에 적응할 수 있는 유연성을 확보한다. 다만 QMTL은 데이터베이스 기반이 아닌 실시간 메시지 큐 기반으로 동작하며, View 대신 메모리 기반 캐시 구조와 사용자 정의 연산 엔진을 통해 처리된다는 점에서 구현 계층이 다르다. 이러한 차이에도 불구하고, 시간 기반 데이터 집계 성능을 소프트웨어 레벨에서 유사하게 재현하고자 하는 점에서 설계 철학은 구조적으로 유사하다고 볼 수 있다.</p>
<h4 id="tagbased-multiupstream">Tag‑based Multi‑Upstream 큐 자동 매핑</h4>
<ul>
<li><strong>Tags 필드</strong>: 각 노드는 하나 이상의 <code>tags</code> 배열을 가질 수 있으며, 이는 데이터 성격(예: <code>price</code>, <code>orderbook</code>, <code>flow</code>)이나 자산(<code>BTC</code>, <code>ETH</code>) 등을 표현한다.</li>
<li><strong>전략 작성 시 사용 방식</strong>:</li>
</ul>
<p><code>python
  price_stream = StreamInput(
            tags=["BTC", "price"],  # 다중 태그로 큐 자동 매핑
            interval="60s",    # 1분 간격 데이터
            period=30       # 최소 30개 필요
        )
      tags=["BTC", "price"],  # 여러 태그 지정
      interval="60s",
      period=30
  )</code>
* <strong>큐 해석 규칙</strong></p>
<ol>
<li>Gateway는 <code>(tags, interval)</code> 조합으로 DAG Manager에 질의하여 <strong>전역 DAG에 존재하는 모든 토픽</strong> 중 조건을 만족하는 큐 ID 집합을 가져온다.</li>
<li>SDK는 반환된 큐 리스트를 업스트림으로 등록하며, 필요 시 각 큐별로 독립된 CircularBuffer를 초기화한다.</li>
<li>노드 실행 시 여러 큐를 <strong>concatenate / align</strong> 처리하여 하나의 시계열 데이터프레임으로 전달하거나, 사용자 정의 집계 함수를 통해 병합한다.</li>
<li><strong>장점</strong>: 전략 코드는 자산(sym) 추가 시 태그만 확장하면 되므로 <strong>동형 전략의 대량 배치</strong>에 용이하며, 큐 이름 변경·증가에 대한 민감도가 낮다.</li>
</ol>
<h3 id="32-p0">3.2 운영 신뢰성과 결정성 강화 (P0 제안 요약)</h3>
<ol>
<li><strong>단일 실행 보장(Once-and-Only-Once)</strong><br />
   NodeID와 시간 버킷을 파티션 키로 삼아 Kafka 파티션 및 리스(lease) 기반 오너십을 부여하고, 트랜잭셔널 커밋 로그로 중복 산출물을 제거한다.</li>
<li><strong>이벤트-타임 워터마크와 지연 허용</strong><br />
   NodeCache가 워터마크를 유지하며 허용 지연 이내의 역행 데이터는 재계산하고, 초과 데이터는 정책에 따라 무시하거나 별도 처리한다.</li>
<li><strong>런타임 지문(runtime fingerprint)</strong><br />
   Python, NumPy 등 런타임 버전을 fingerprint로 기록하고, <code>runtime_compat</code> 정책에 따라 재사용 여부를 결정한다.</li>
<li><strong>스냅샷 상태 하이드레이션</strong><br />
   주기적으로 NodeCache를 Arrow/Parquet 스냅샷으로 저장해 재기동 시 하이드레이션함으로써 웜업 시간을 크게 단축한다.</li>
<li><strong>Schema Registry 및 CloudEvents 사용</strong><br />
   데이터 토픽은 Avro/Proto와 Schema Registry로 버전 호환성을 확보하고, 컨트롤 토픽은 CloudEvents over Protobuf로 통일한다.</li>
</ol>
<hr />
<h2 id="4">4. 실행 모드 및 구성요소 역할</h2>
<h3 id="41">4.1 전략 실행 모드</h3>
<p>QMTL의 모든 실행 모드는 각 노드가 종속된 업스트림 큐로부터 정해진 <code>interval</code> 및 <code>period</code>에 해당하는 데이터를 확보한 이후에만 연산 결과를 생성할 수 있다. 즉, 백테스트이든 실시간 실행이든, <strong>모든 노드는 초기 period가 충족되지 않으면 데이터를 생성할 수 없으며</strong>, 해당 상태는 'pre-warmup' 상태로 간주된다. 이는 연산 일관성을 보장하고, 누락된 데이터로 인한 왜곡을 방지하기 위함이다.</p>
<ul>
<li>
<p>각 노드는 실행 시점에 다음 조건을 충족해야 함:</p>
</li>
<li>
<p>설정된 모든 업스트림에 대해 period × interval 만큼의 데이터가 수신되었는가?</p>
</li>
<li>interval마다 데이터가 정확히 정렬되었고, 이상치 또는 결측이 보정되었는가?</li>
</ul>
<p>이 제약 조건은 초기 전략 실행 지연을 감수하더라도 연산의 정확도를 우선시하며, 특히 실시간 환경에서도 노이즈나 불완전한 초기 큐 상태로 인한 오동작을 방지하는 데 핵심적인 역할을 한다. 예를 들어, interval=60s, period=30으로 설정된 노드는 최소 30분간의 데이터가 수집되기 전까지는 출력을 생성하지 않으며, 평균적으로 실시간 환경에서 30분 내외의 warmup 시간이 소요된다. 특히 MFI, RSI와 같은 지표 기반 전략은 이전 캔들 히스토리에 강하게 의존하기 때문에, warmup이 되지 않은 상태에서의 실행은 잘못된 매매 신호를 유발할 수 있다. 시스템 수준에서는 해당 노드가 'pre-warmup' 상태임을 로그 레벨에서 명시적으로 기록하며, 사용자는 UI 상에서도 각 노드별 warmup 상태를 직관적으로 확인할 수 있도록 하여 운영자가 초기 상태를 추적하고 안정적으로 전략 실행을 통제할 수 있도록 한다.
QMTL은 다음 두 가지 전략 실행 모드를 기본적으로 제공해야 한다:</p>
<ol>
<li>
<p><strong>백테스트 모드 (Backtest Mode)</strong></p>
</li>
<li>
<p>사용자는 전략 실행 시 명시적인 <code>시작 시간(start_time)</code>과 <code>종료 시간(end_time)</code>을 지정해야 한다.</p>
</li>
<li>SDK는 해당 구간의 데이터를 리플레이 방식으로 처리하며, 각 노드의 interval 및 period 설정에 따라 입력 데이터를 정렬 후 연산을 수행한다.</li>
<li>
<p>데이터 수급 실패나 결측이 발생할 경우, 해당 노드 또는 전략은 지정된 정책에 따라</p>
<ol>
<li>해당 시간 블록을 건너뛰고 다음 블록으로 이동하거나,</li>
<li>에러 상태로 전환되어 중단될 수 있으며,</li>
<li>로그 수준에서 누락 정보를 기록한 후 사용자에게 알림을 보낸다.</li>
<li>이러한 예외 처리 정책은 전략별 설정 파일에서 명시 가능하며, 시스템의 기본 정책은 "skip-on-missing"이다.</li>
<li>사용 목적: 전략 성능 검증, 파라미터 튜닝, 회귀 테스트 등.</li>
</ol>
</li>
<li>
<p><strong>실시간 모드 (Realtime Mode)</strong></p>
</li>
</ol>
<p><strong>✅ 두 가지 하위 모드 제공</strong></p>
<table>
<thead>
<tr>
<th>하위 모드</th>
<th>목적</th>
<th>특징</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>live</code></strong>** (기본값)**</td>
<td>실제 주문 및 알림 전송</td>
<td>매매 실행 노드 활성화, 거래소/브로커 API 호출, PnL 실시간 반영</td>
</tr>
<tr>
<td><strong><code>dry-run</code></strong></td>
<td>전략 검증·시뮬레이션</td>
<td>매매 실행 노드가 PaperTrading 노드로 자동 대체, 주문은 기록되나 미발주, 실시간 성과(PnL) 로그 저장</td>
</tr>
</tbody>
</table>
<ul>
<li>전략 실행 요청 시 <code>mode="realtime", run_type="dry-run"</code> 또는 <code>run_type="live"</code> 플래그를 전달한다.</li>
<li>지표 계산(DAG 예: RSI, MFI)만 포함된 전략은 일반적으로 <code>live</code> 모드로 바로 실행 가능하지만, <strong>매매 판단 및 주문 트리거를 포함하는 전략</strong>은 먼저 <code>dry-run</code> 모드로 운영 환경에서 성과를 측정하고, 목표 KPI(PnL, 매수·매도 빈도 등)를 충족할 때 <code>live</code> 로 전환하는 것을 권장한다.</li>
<li><code>dry-run</code> 모드에서 수집된 주문 로그와 PnL은 SDK가 제공하는 분석 유틸리티를 통해 백테스트 결과와 동일한 포맷으로 저장되어, 비교·검증이 용이하다.</li>
</ul>
<p>이와 같은 모드 구분은 전략 실행 API 설계 시 필수적인 파라미터 구성 기준이 되며, 각 모드별 리소스 예약, 큐 구독 범위, 캐시 초기화 방식이 달라진다.</p>
<hr />
<h2 id="runner-api">부록: 일반 전략 예시 코드 (Runner API 적용)</h2>
<p>다음은 QMTL 아키텍처의 핵심 요구사항을 모두 충족하는 일반 전략 예시이다. 이 전략은 사용자 정의 연산 함수를 사용하고, 노드 간 직접 참조를 기반으로 DAG을 구성하며, interval/period 기반 캐싱, 실행 모드 구분, pre-warmup 제약 조건 등을 모두 반영한다.</p>
<pre><code class="language-python">from qmtl.sdk import Strategy, Node, StreamInput, Runner
import pandas as pd

# 사용자 정의 시그널 생성 함수
def generate_signal(view) -&gt; pd.DataFrame:
    price = pd.DataFrame([v for _, v in view[price_stream][60]])
    momentum = price[&quot;close&quot;].pct_change().rolling(5).mean()
    signal = (momentum &gt; 0).astype(int)
    return pd.DataFrame({&quot;signal&quot;: signal})

# 전략 정의
class GeneralStrategy(Strategy):
    def setup(self):
        price_stream = StreamInput(
            interval=&quot;60s&quot;,    # 1분 간격 데이터
            period=30       # 최소 30개 필요
        )

        signal_node = Node(
            input=price_stream,
            compute_fn=generate_signal,
            name=&quot;momentum_signal&quot;
        )

        self.add_nodes([price_stream, signal_node])

# 백테스트 실행 예시
if __name__ == &quot;__main__&quot;:
    Runner.backtest(
        GeneralStrategy,
        start_time=&quot;2024-01-01T00:00:00Z&quot;,
        end_time=&quot;2024-02-01T00:00:00Z&quot;,
        on_missing=&quot;skip&quot;
    )
</code></pre>
<hr />
<h3 id="tag-query-strategy-upstream">부록: Tag Query Strategy 예시 (다중 Upstream 자동 선택)</h3>
<p>아래 예시는 글로벌 DAG에 이미 존재하는 1시간 단위 RSI, MFI 지표 노드들이 <code>tags=["ta-indicator"]</code> 로 태깅되어 있을 때, 이를 <strong>TagQueryNode</strong> 를 통해 한 번에 업스트림으로 끌어와 상관계수를 계산(correlation)하는 전략이다.</p>
<pre><code class="language-python">from qmtl.sdk import Strategy, Node, TagQueryNode, run_strategy
import pandas as pd

# 사용자 정의 상관계수 계산 함수
def calc_corr(view) -&gt; pd.DataFrame:
    indicator_df = pd.concat([pd.DataFrame([v for _, v in view[u][3600]]) for u in view], axis=1)
    # 컬럼 간 피어슨 상관계수 행렬 반환
    corr = indicator_df.corr(method=&quot;pearson&quot;)
    return corr

class CorrelationStrategy(Strategy):
    def setup(self):
        # TagQueryNode: 지정 태그+interval에 매칭되는 모든 업스트림 자동 수집
        indicators = TagQueryNode(
            query_tags=[&quot;ta-indicator&quot;],  # RSI, MFI 등 사전 계산 지표 노드들과 매칭
            interval=&quot;1h&quot;,               # 1시간 바 기준
            period=24,                    # 24시간 캐시(24개)
            match_mode=&quot;any&quot;,             # 기본값은 OR 매칭
            compute_fn=calc_corr          # 병합 후 바로 상관계수 계산
        )

        corr_node = Node(
            input=indicators,
            compute_fn=calc_corr,
            name=&quot;indicator_corr&quot;
        )

        self.add_nodes([indicators, corr_node])

        # match_mode=&quot;any&quot; 는 하나 이상의 태그가 일치하면 매칭되며,
        # &quot;all&quot; 로 지정하면 모든 태그가 존재하는 큐만 선택된다.

# 실시간 실행 예시
if __name__ == &quot;__main__&quot;:
    Runner.live(CorrelationStrategy)
</code></pre>
<p><strong>TagQueryNode 동작 요약</strong></p>
<ol>
<li>Runner가 생성한 <strong>TagQueryManager</strong>가 Gateway에 <code>(query_tags, interval)</code> 조건을 조회한다.</li>
<li>Gateway는 글로벌 DAG을 탐색한 후 매칭되는 큐 목록을 반환하고, TagQueryManager가 이를 <code>TagQueryNode</code> 에 전달한다.</li>
<li>TagQueryNode는 받은 큐 ID만 보관하며, 실제 Kafka 구독과 WebSocket 갱신 역시 TagQueryManager가 담당한다.</li>
<li>SDK는 각 큐의 데이터를 수집해 read-only <strong>CacheView</strong> 하나로 묶어 <code>compute_fn</code>에 전달한다. <code>compute_fn</code>은 반드시 이 뷰 단일 인자만을 받아야 하며, 병합 방식 역시 함수 내부에서 정의한다.</li>
<li>각 큐가 설정된 period를 만족하지 않으면 노드는 ‘pre-warmup’ 상태에 머물며, Gateway가 새로운 큐를 발견하면 TagQueryManager가 <code>update_queues()</code>를 호출해 런타임 중에도 업스트림 목록을 확장한다.</li>
</ol>
<pre><code class="language-mermaid">sequenceDiagram
    participant R as Runner
    participant M as TagQueryManager
    participant G as Gateway
    participant N as TagQueryNode
    R-&gt;&gt;M: register TagQueryNode
    M-&gt;&gt;G: GET /queues/by_tag
    G--&gt;&gt;M: queue list
    M-&gt;&gt;N: update_queues(list)
    G--&gt;&gt;M: queue_update (WebSocket)
    M-&gt;&gt;N: update_queues(list)
</code></pre>
<p>이 구조로 전략 작성자는 <strong>큐 이름이나 위치를 몰라도 태그 기반으로 지표 집합을 참조</strong>할 수 있으며, 지표가 추가될 때마다 전략 수정 없이 자동 반영된다.</p>
<hr />
<h2 id="crossmarket-lag-strategy">부록: 교차 시장 전략 예시 (Cross‑Market Lag Strategy)</h2>
<p>비트코인 가격(Binance) 상승이 일정 시차(예: 90분) 후 마이크로스트레티지(MSTR, Nasdaq) 주가 상승으로 이어진다는 가설을 검증·운용하는 전략 예시이다. 입력·출력 시장이 서로 다르므로, <strong>데이터 수집(암호화폐)</strong> 과 <strong>매매 판단(주식)</strong> 노드를 분리하고, 실시간에서는 먼저 <code>dry-run</code>으로 성과를 확인한 뒤 <code>live</code>로 전환한다.</p>
<pre><code class="language-python">from qmtl.sdk import Strategy, Node, StreamInput, Runner
import pandas as pd

def lagged_corr(view) -&gt; pd.DataFrame:
    btc = pd.DataFrame([v for _, v in view[btc_price][60]])
    mstr = pd.DataFrame([v for _, v in view[mstr_price][60]])
    btc_shift = btc[&quot;close&quot;].shift(90)
    corr = btc_shift.corr(mstr[&quot;close&quot;])
    return pd.DataFrame({&quot;lag_corr&quot;: [corr]})

class CrossMarketLagStrategy(Strategy):
    def setup(self):
        btc_price = StreamInput(tags=[&quot;BTC&quot;, &quot;price&quot;, &quot;binance&quot;], interval=&quot;60s&quot;, period=120)
        mstr_price = StreamInput(tags=[&quot;MSTR&quot;, &quot;price&quot;, &quot;nasdaq&quot;], interval=&quot;60s&quot;, period=120)

        corr_node = Node(
            input=[btc_price, mstr_price],
            compute_fn=lagged_corr,
            name=&quot;btc_mstr_corr&quot;
        )

        self.add_nodes([btc_price, mstr_price, corr_node])

# 실시간 dry‑run: 거래 여부 검증
Runner.dryrun(CrossMarketLagStrategy)
</code></pre>
<blockquote>
<p><strong>동작 요약</strong></p>
<ol>
<li>Binance 1분 BTC 가격과 Nasdaq 1분 MSTR 가격 큐를 각각 태그로 매핑.</li>
<li>90분(90샘플) 시차 상관계수를 지속 계산하여 <code>lag_corr</code> ≥ 임계값이면 별도 매매 DAG(주식 매수)로 신호 전달 가능.</li>
<li><code>Runner.dryrun()</code> 으로 실시간 시뮬레이션 후, 충분한 PnL·승률이 검증되면 동일 코드로 <code>Runner.live()</code> 전환.</li>
</ol>
</blockquote>
<hr />
<h2 id="5">5. 구성요소 역할 및 기술 스택</h2>
<table>
<thead>
<tr>
<th>컴포넌트</th>
<th>기능</th>
<th>주 기술 스택</th>
</tr>
</thead>
<tbody>
<tr>
<td>SDK</td>
<td>DAG 생성, 전략 코드 실행, 로컬 연산 병렬 처리</td>
<td>Python 3.11, Ray, Pydantic</td>
</tr>
<tr>
<td>Gateway</td>
<td>상태 FSM, 전략 전이 로직, DAG diff 수행, 콜백 전송</td>
<td>FastAPI, Redis, PostgreSQL, xstate-py</td>
</tr>
<tr>
<td>DAG Manager</td>
<td>Neo4j 기반 전역 DAG 저장 및 증분 쿼리, 큐 생성 판단</td>
<td>Neo4j 5.x, APOC, Kafka Admin Client</td>
</tr>
<tr>
<td>Infra</td>
<td>메시지 중개 및 운영 관측 지표 수집</td>
<td>Redpanda, Prometheus, Grafana, MinIO</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ownership-model">Ownership Model</h2>
<ul>
<li><strong>SDK</strong> — 로컬에서 DAG를 실행하고 결과를 캐시하지만 전역 상태는 소유하지 않는다.</li>
<li><strong>Gateway</strong> — 제출 요청의 수명주기와 Redis 기반 FSM을 관리하나, 그래프·월드·큐의 SSOT는 아니다.</li>
<li><strong>DAG Manager</strong> — 전역 ComputeNode와 Queue 메타데이터의 단일 소스이며 토픽 생성·GC를 전담한다.</li>
<li><strong>WorldService</strong> — 월드/정책/결정/활성 상태의 소유자이며, 해당 변경을 ControlBus에 발행한다.</li>
<li><strong>Infra(Redpanda/Kafka)</strong> — 데이터·컨트롤 평면 스트림의 영속성을 제공하는 커밋 로그 저장소.</li>
</ul>
<hr />
<h2 id="commit-log-design">Commit-Log Design</h2>
<p>QMTL은 <strong>append-only commit log</strong> 설계를 채택하여 모든 상태 변화를 재생 가능한 이벤트로 남긴다.</p>
<ol>
<li>각 ComputeNode의 출력은 고유 Kafka 토픽(큐)에 append되어, 과거 데이터를 필요 시 재생(replay)할 수 있다.</li>
<li>DAG Manager는 큐 생성/갱신과 <code>QueueUpdated</code>, <code>sentinel_weight</code>와 같은 컨트롤 이벤트를 ControlBus 토픽에 발행한다.</li>
<li>Gateway는 전략 제출을 <code>gateway.ingest</code> 로그에 기록한 뒤 Diff 결과를 처리하고, 오프셋을 Redis에 저장해 최소 한 번(at-least-once) 처리 보장한다.</li>
<li>WorldService 역시 활성/결정 이벤트를 동일한 커밋 로그에 남겨 감사(audit)와 롤백을 지원한다.</li>
</ol>
<p>이와 같은 로그 기반 설계는 서비스별 <strong>소유권 경계</strong>를 명확히 하며, 장애 발생 시 정확한 시점으로 상태를 복원할 수 있는 토대를 제공한다.</p>
<hr />
<h2 id="6-deterministic-checklist-v09">6. Deterministic Checklist (v0.9)</h2>
<p>아래 항목들은 전역 DAG 일관성 및 고신뢰 큐 오케스트레이션을 보장하기 위해 실무에서
검증해야 하는 세부 사항이다.</p>
<ol>
<li><strong>Gateway ↔ SDK CRC 검증</strong> — Gateway가 계산한 <code>node_id</code>와 SDK가 사전 계산한
   값이 <code>crc32</code> 필드로 상호 검증된다.</li>
<li><strong>NodeCache 가드레일 &amp; GC</strong> — period × interval 초과 슬라이스를 즉시 evict하고
   Arrow chunk 기반 zero‑copy 전달을 보장한다.</li>
<li><strong>Kafka Topic Create 재시도</strong> — <code>CREATE_TOPICS→VERIFY→WAIT→BACKOFF</code> 5단계로
   재시도하며, VERIFY 단계에서 broker metadata를 조회해 유사 이름 충돌을 제거한다.</li>
<li><strong>Sentinel Traffic Shift 확인</strong> — <code>traffic_weight</code> 변경 시 Gateway와 SDK가 5초
   이내 동기화되었는지 측정한다.</li>
<li><strong>TagQueryNode 동적 확장</strong> — Gateway가 새 <code>(tags, interval)</code> 큐를 발견하면
   <code>tagquery.upsert</code> CloudEvent를 발행하고, Runner의 <strong>TagQueryManager</strong>가 이를
   수신해 각 노드의 버퍼를 자동 초기화한다.</li>
<li><strong>Minor‑schema 버퍼링</strong> — <code>schema_minor_change</code>는 재사용하되 7일 후 자동
   full‑recompute가 실행된다.</li>
<li><strong>SSA DAG Lint</strong> — SDK 빌드 시 DAG를 SSA 중간 표현으로 변환해 해시 불일치를
   탐지한다.</li>
<li><strong>Golden‑Signal Alert</strong> — Prometheus Rule CRD로 <code>diff_duration_ms_p95</code>,
   <code>nodecache_resident_bytes</code>, <code>sentinel_gap_count</code>에 대한 Alert가 관리된다.</li>
<li><strong>극단 장애 플레이북</strong> — Neo4j 전체 장애, Kafka 메타데이터 손상, Redis AOF
   손실 시나리오별 Runbook과 Grafana 대시보드를 교차 링크한다.</li>
<li><strong>4‑단계 CI/CD Gate</strong> — Pre‑merge SSA Lint와 빠른 백테스트, 24h 카나리아,
    50% 프로모션, 한 줄 롤백 명령으로 이어지는 파이프라인을 구축한다.</li>
</ol>
<p>위 목록이 모두 충족된 시점을 QMTL v0.9 “Determinism” 마일스톤으로 삼는다.</p>
<p><strong>Related:</strong> <a href="../">Overview</a>, <a href="./">Architecture &amp; Ownership</a>, <a href="../glossary/">Glossary</a>, <a href="../dag-manager/">DAG Manager</a>, <a href="../gateway/">Gateway</a>, <a href="../worldservice/">World Service</a>, <a href="../controlbus/">ControlBus</a>, <a href="../lean_brokerage_model/">Lean Brokerage Model</a>, <a href="../../reference/api/brokerage/">Brokerage API</a>, <a href="../implementation_todos/">Implementation TODOs</a></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "navigation.expand", "navigation.path"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>