name: qmtl-strategies rules
version: 1

meta:
  description: |
    이 저장소는 QMTL 기반 전략 개발과 동시에 QMTL 프레임워크의 문제/개선을
    즉시 반영하기 위해 운영된다. 따라서 `qmtl` 서브모듈은 항상 최신 상태를
    유지해야 하며, 모든 에이전트/도구 동작은 이를 전제로 한다.

agents:
  - match: "*"
    rules:
      - id: submodule-always-fresh
        intent: 서브모듈 최신 유지 강제
        text: |
          - 모든 작업(탐색/코딩/테스트/실행) 시작 전에 `qmtl` 서브모듈을 최신으로 동기화한다.
          - 다음 명령을 우선 제안/사용한다(비대화식 플래그 선호):
            ```bash
            git submodule update --init --recursive --remote
            git -C qmtl fetch --all --prune || true
            git -C qmtl checkout main || true
            git -C qmtl pull --ff-only || true
            ```
          - 서브모듈 포인터가 변경되면 루트 리포지토리에 반드시 커밋한다:
            ```bash
            git add qmtl && git commit -m "chore: bump qmtl submodule to latest"
            ```

      - id: cross-change-policy
        intent: 전략 개발과 QMTL 개선을 동시 진행
        text: |
          - 전략 개발 중 발견된 QMTL 버그/개선은 `qmtl/` 서브모듈 내부에서 먼저 수정하고 테스트한다.
          - qmtl은 서브모듈이지만 별도 프로젝트로 간주한다. 변경 시 `qmtl/AGENTS.md`의 가이드에 따라 수정/테스트/커밋/PR을 수행한다.
          - 루트 전략 코드와 테스트를 동시에 갱신하며, 포인터 업데이트를 함께 커밋한다.
          - PR 체크리스트에 다음 항목을 포함한다:
            - [ ] `git submodule status --recursive` 결과 확인
            - [ ] `qmtl/tests` 및 루트 `tests` 모두 통과

      - id: commands-noninteractive
        intent: 명령은 비대화식으로 제안/실행
        text: |
          - 사용자의 상호작용이 필요 없도록 `--yes` 등 비대화식 옵션을 사용한다.
          - 긴 출력은 파이프/요약을 사용하며, pager 사용은 금지한다.

      - id: documentation-footers
        intent: 문서/코드 변경 시 각주로 서브모듈 정책 상기
        text: |
          - 문서/가이드/README/AGENTS.md 변경 시, 하단에 "서브모듈 최신화" 섹션을 유지한다.

snippets:
  quick-check:
    text: |
      # 현재 서브모듈 상태/브랜치 확인
      git submodule status --recursive
      git -C qmtl rev-parse --abbrev-ref HEAD && git -C qmtl log --oneline -n 3


